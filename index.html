<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etai's Tower Defence</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="game-container">
        <!-- Top Info Bar -->
        <div id="top-bar">
            <div class="info-items" style="display:flex;gap:8px;">
                <span id="wave-info" class="info-item">Wave: 0/20</span>
                <span id="gold-info" class="info-item">Gold: 200</span>
                <span id="score-info" class="info-item">Score: 0</span>
                <span id="record-info" class="info-item">Record: 0</span>
            </div>
            <div class="controls">
                <span id="lives-info" class="lives-badge">20</span>
                <button id="next-wave-btn">Next Wave</button>
                <button class="speed-btn" data-speed="1">1x</button>
                <button class="speed-btn active" data-speed="2">2x</button>
                <button class="speed-btn" data-speed="3">3x</button>
                <button id="pause-btn">Start</button>
                <button id="mute-btn">Mute</button>
            </div>
        </div>

        <!-- 3-Layer Canvas Stack -->
        <div id="canvas-wrapper">
            <canvas id="terrain-canvas"></canvas>
            <canvas id="game-canvas"></canvas>
            <canvas id="ui-canvas"></canvas>

            <!-- Tower Info Popup -->
            <div id="tower-info"></div>

            <!-- Game Screens -->
            <div id="menu-screen" class="game-screen visible">
                <div class="screen-title">Etai's Tower Defence</div>
                <div class="screen-subtitle">Choose a map to begin. Defend against 20 waves of enemies!</div>
                <div id="map-select"></div>
                <div class="key-hints">
                    <kbd>1</kbd>-<kbd>5</kbd> Select tower &nbsp;
                    <kbd>Space</kbd> Pause &nbsp;
                    <kbd>N</kbd> Next wave &nbsp;
                    <kbd>+</kbd>/<kbd>-</kbd> Speed
                    <br>
                    <kbd>U</kbd> Upgrade &nbsp;
                    <kbd>S</kbd> Sell &nbsp;
                    <kbd>T</kbd> Target mode &nbsp;
                    <kbd>Esc</kbd> Deselect
                </div>
                <button id="manual-btn" class="screen-btn manual-btn">How to Play</button>
            </div>

            <div id="manual-screen" class="game-screen">
                <div class="manual-container">
                    <div class="manual-header">
                        <div class="screen-title">How to Play</div>
                        <button id="manual-close-btn" class="screen-btn">Back</button>
                    </div>
                    <div class="manual-scroll">

                        <div class="manual-section">
                            <h2>Goal</h2>
                            <p>Build and upgrade towers to stop 20 waves of enemies from reaching the exit. You start with 20 lives and 200 gold. If an enemy reaches the end, you lose lives. Lose them all and it's game over.</p>
                        </div>

                        <div class="manual-section">
                            <h2>Maps</h2>
                            <div class="manual-cards">
                                <div class="manual-card">
                                    <div class="manual-card-title" style="color:#27ae60">Serpentine Valley <span class="manual-badge" style="background:#27ae60">Easy</span></div>
                                    <p>Long winding path with 10+ turns. Plenty of time to damage enemies. Best for learning.</p>
                                </div>
                                <div class="manual-card">
                                    <div class="manual-card-title" style="color:#f39c12">Split Creek <span class="manual-badge" style="background:#f39c12">Medium</span></div>
                                    <p>Path forks into two branches. Enemies randomly pick a route, forcing you to defend both sides.</p>
                                </div>
                                <div class="manual-card">
                                    <div class="manual-card-title" style="color:#e74c3c">The Gauntlet <span class="manual-badge" style="background:#e74c3c">Hard</span></div>
                                    <p>Short direct path with 3 turns. Enemies arrive fast — every tower counts. HP scaled to 65%.</p>
                                </div>
                            </div>
                        </div>

                        <div class="manual-section">
                            <h2>Towers</h2>
                            <table class="manual-table">
                                <thead>
                                    <tr><th>Tower</th><th>Cost</th><th>Damage</th><th>Range</th><th>Rate</th><th>Special</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="manual-dot" style="background:#4a7c3f"></span> Arrow</td>
                                        <td>$50</td><td>12/18/28</td><td>3.5/4/4.5</td><td>2.5/3/4/s</td>
                                        <td>Cheap, fast, reliable DPS. Best gold efficiency.</td>
                                    </tr>
                                    <tr>
                                        <td><span class="manual-dot" style="background:#8b5e3c"></span> Cannon</td>
                                        <td>$100</td><td>30/50/80</td><td>3/3.5/4</td><td>0.8/1/1.2/s</td>
                                        <td>Splash damage. Unlocks wave 2. Essential vs groups.</td>
                                    </tr>
                                    <tr>
                                        <td><span class="manual-dot" style="background:#5b9bd5"></span> Frost</td>
                                        <td>$75</td><td>5/8/12</td><td>3/3.5/4</td><td>1.3/1.4/1.7/s</td>
                                        <td>Slows enemies 50-70%. Key support tower.</td>
                                    </tr>
                                    <tr>
                                        <td><span class="manual-dot" style="background:#9b59b6"></span> Lightning</td>
                                        <td>$125</td><td>15/22/32</td><td>3.5/4/4.5</td><td>1/1.2/1.4/s</td>
                                        <td>Chains to 3-5 enemies. 70% damage per bounce.</td>
                                    </tr>
                                    <tr>
                                        <td><span class="manual-dot" style="background:#c0392b"></span> Sniper</td>
                                        <td>$150</td><td>60/90/140</td><td>6/7/8</td><td>0.5/0.6/0.7/s</td>
                                        <td>Huge range. 10-20% crit chance for 2.5-3x damage.</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="manual-tip">Upgrade costs: Arrow $35/$70 | Cannon $65/$125 | Frost $55/$100 | Lightning $80/$145 | Sniper $110/$180</p>
                        </div>

                        <div class="manual-section">
                            <h2>Enemies</h2>
                            <table class="manual-table">
                                <thead>
                                    <tr><th>Enemy</th><th>HP</th><th>Speed</th><th>Armor</th><th>Special</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td style="color:#e74c3c">Grunt</td><td>30</td><td>Medium</td><td>0%</td><td>Standard enemy</td></tr>
                                    <tr><td style="color:#f39c12">Runner</td><td>15</td><td>Fast</td><td>0%</td><td>Low HP but hard to hit</td></tr>
                                    <tr><td style="color:#2c3e50">Tank</td><td>120</td><td>Slow</td><td>30%</td><td>Absorbs damage, costs 2 lives</td></tr>
                                    <tr><td style="color:#2ecc71">Healer</td><td>50</td><td>Medium</td><td>0%</td><td>Heals nearby allies 3 HP/s</td></tr>
                                    <tr><td style="color:#8e44ad">Boss</td><td>400</td><td>Very slow</td><td>20%</td><td>Massive HP, costs 5 lives</td></tr>
                                    <tr><td style="color:#e67e22">Swarm</td><td>8</td><td>Fast</td><td>0%</td><td>Comes in huge numbers</td></tr>
                                </tbody>
                            </table>
                            <p class="manual-tip">HP scales exponentially each wave. By wave 20, enemies have ~30x more HP than wave 1. Armor reduces ALL incoming damage by its percentage.</p>
                        </div>

                        <div class="manual-section">
                            <h2>Economy</h2>
                            <div class="manual-cards">
                                <div class="manual-card"><strong>Kill bonus:</strong> +10% gold on kills</div>
                                <div class="manual-card"><strong>Wave bonus:</strong> 25 + (wave x 10) gold</div>
                                <div class="manual-card"><strong>Interest:</strong> 2% of gold between waves</div>
                                <div class="manual-card"><strong>Sell refund:</strong> 60% of total invested</div>
                            </div>
                        </div>

                        <div class="manual-section">
                            <h2>Targeting Modes (T)</h2>
                            <div class="manual-cards">
                                <div class="manual-card"><strong style="color:#3498db">First</strong> — Furthest along the path (default, usually best)</div>
                                <div class="manual-card"><strong style="color:#2ecc71">Closest</strong> — Nearest to the tower</div>
                                <div class="manual-card"><strong style="color:#e74c3c">Strongest</strong> — Most HP (use for snipers vs bosses)</div>
                                <div class="manual-card"><strong style="color:#f39c12">Weakest</strong> — Least HP (use to pick off healers)</div>
                            </div>
                        </div>

                        <div class="manual-section">
                            <h2>Key Strategies</h2>
                            <ul class="manual-list">
                                <li><strong>Corners are king.</strong> Towers at path turns hit enemies on two segments, doubling their value.</li>
                                <li><strong>Frost before damage.</strong> Place frost towers early in your killzone so enemies are slowed before they reach damage dealers.</li>
                                <li><strong>Don't spread thin.</strong> A concentrated killzone of 4-5 towers beats 8 towers spread across the map.</li>
                                <li><strong>Upgrade over expand.</strong> A level 3 Arrow outperforms two level 1 Arrows for less gold.</li>
                                <li><strong>Kill healers first.</strong> Set one tower to Weakest targeting to pick them off before they sustain tanks.</li>
                                <li><strong>Bank for interest.</strong> Saving gold between waves earns 2% interest. Sometimes waiting pays off.</li>
                                <li><strong>Path coverage number.</strong> When placing a tower, the yellow number shows how many path cells are in range. Aim for 8+.</li>
                            </ul>
                        </div>

                        <div class="manual-section">
                            <h2>Controls</h2>
                            <table class="manual-table">
                                <tbody>
                                    <tr><td><kbd>1</kbd>-<kbd>5</kbd></td><td>Select tower type</td></tr>
                                    <tr><td>Click</td><td>Place tower / Select placed tower</td></tr>
                                    <tr><td>Right-click / <kbd>Esc</kbd></td><td>Cancel selection</td></tr>
                                    <tr><td><kbd>U</kbd></td><td>Upgrade selected tower</td></tr>
                                    <tr><td><kbd>S</kbd></td><td>Sell selected tower</td></tr>
                                    <tr><td><kbd>T</kbd></td><td>Cycle targeting mode</td></tr>
                                    <tr><td><kbd>Space</kbd></td><td>Pause / Resume</td></tr>
                                    <tr><td><kbd>N</kbd></td><td>Send next wave early</td></tr>
                                    <tr><td><kbd>+</kbd> / <kbd>-</kbd></td><td>Game speed (1x / 2x / 3x)</td></tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

            <div id="game-over-screen" class="game-screen">
                <div class="screen-title">Game Over</div>
                <div class="screen-subtitle">Your defenses have fallen!</div>
                <div id="game-over-score" class="screen-score"></div>
                <button id="restart-btn" class="screen-btn">Try Again</button>
            </div>

            <div id="victory-screen" class="game-screen">
                <div class="screen-title">Victory!</div>
                <div class="screen-subtitle">You survived all 20 waves! Excellent strategy!</div>
                <div id="victory-score" class="screen-score"></div>
                <button id="restart-btn-victory" class="screen-btn">Play Again</button>
            </div>
        </div>

        <!-- Bottom Tower Panel -->
        <div id="bottom-bar">
            <div id="tower-panel"></div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
